---
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Profile from '../../components/Profile.astro';
import Porse from '../../components/Porse.astro';
import PageLayout from '../../layouts/PageLayout.astro';
import { compareDesc, format } from 'date-fns';
import { SITE_TITLE, SITE_DESCRIPTION } from '../../config';
import { getCollection } from 'astro:content';

const notes = await getCollection('notes').then((notes) =>
  notes.sort((a, b) => compareDesc(a.data.pubDate, b.data.pubDate))
);

const noteContents = await Promise.all(
  notes.map((note) =>
    note.render().then(({ Content }) => ({ slug: note.slug, pubDate: note.data.pubDate, Content }))
  )
);
---

<PageLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <Fragment slot="other-head">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"
      integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC"
      crossorigin="anonymous"
    />
  </Fragment>

  <Fragment slot="header">
    <Header />
  </Fragment>

  <Profile />

  <Porse>
    <div class="flex flex-col gap-4">
      {
        noteContents.map(({ slug, pubDate, Content }) => (
          <div class="mx-4 p-4 rounded-md border border-slate-200 dark:border-slate-700">
            <a href={`/notes/${slug}`}>{format(pubDate, 'yyyy/MM/dd')}</a>
            <Content />
          </div>
        ))
      }
    </div>
  </Porse>

  <Fragment slot="footer">
    <Footer />
  </Fragment>
</PageLayout>
